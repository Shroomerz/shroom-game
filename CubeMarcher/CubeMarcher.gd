@icon("res://CubeMarcher/cube_marcher_icon.png")
class_name CubeMarcher
extends Node

var precision :Vector3 = Vector3(0.1, 0.1, 0.1)
var sdf :SDF

func set_SDF(f_sdf :SDF):
	sdf = f_sdf
	_negative_bound = sdf.get_negative_bound()
	_positive_bound = sdf.get_positive_bound()

var _treshold = 0.1
var _negative_bound :Vector3
var _positive_bound :Vector3
const _vertex_lookup = [
	Vector3i(0, 0, 0),
	Vector3i(0, 0, 1),
	Vector3i(0, 1, 0),
	Vector3i(0, 1, 1),
	Vector3i(1, 0, 0),
	Vector3i(1, 0, 1),
	Vector3i(1, 1, 0),
	Vector3i(1, 1, 1),
]

# Lookup tables credit: https://github.com/EricLengyel/Transvoxel/blob/main/Transvoxel.cpp
#	The regularCellData table holds the triangulation data for all 16 distinct classes to
#	 which a case can be mapped by the regularCellClass table.
const _cube_vertex_order = [
	[0x00, []],
	[0x31, [0, 1, 2]],
	[0x62, [0, 1, 2, 3, 4, 5]],
	[0x42, [0, 1, 2, 0, 2, 3]], 
	[0x53, [0, 1, 4, 1, 3, 4, 1, 2, 3]],
	[0x73, [0, 1, 2, 0, 2, 3, 4, 5, 6]],
	[0x93, [0, 1, 2, 3, 4, 5, 6, 7, 8]],
	[0x84, [0, 1, 4, 1, 3, 4, 1, 2, 3, 5, 6, 7]],
	[0x84, [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7]],
	[0xC4, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]],
	[0x64, [0, 4, 5, 0, 1, 4, 1, 3, 4, 1, 2, 3]],
	[0x64, [0, 5, 4, 0, 4, 1, 1, 4, 3, 1, 3, 2]],
	[0x64, [0, 4, 5, 0, 3, 4, 0, 1, 3, 1, 2, 3]],
	[0x64, [0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 5]],
	[0x75, [0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 5, 0, 5, 6]],
	[0x95, [0, 4, 5, 0, 3, 4, 0, 1, 3, 1, 2, 3, 6, 7, 8]],
]

# 	The regularVertexData table gives the vertex locations for every one of the 256 possible
# 	cases in the modified Marching Cubes algorithm. Each 16-bit value also provides information
# 	about whether a vertex can be reused from a neighboring cell. See Section 3.3 for details.
# 	The low byte contains the indexes for the two endpoints of the edge on which the vertex lies,
# 	as numbered in Figure 3.7. The high byte contains the vertex reuse data shown in Figure 3.8.
const _cubes_lookup = [
	[],
	[0x6201, 0x5102, 0x3304],
	[0x6201, 0x2315, 0x4113],
	[0x5102, 0x3304, 0x2315, 0x4113],
	[0x5102, 0x4223, 0x1326],
	[0x3304, 0x6201, 0x4223, 0x1326],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x3304, 0x2315, 0x4113],
	[0x4113, 0x8337, 0x4223],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337],
	[0x6201, 0x2315, 0x8337, 0x4223],
	[0x5102, 0x3304, 0x2315, 0x8337, 0x4223],
	[0x5102, 0x4113, 0x8337, 0x1326],
	[0x4113, 0x8337, 0x1326, 0x3304, 0x6201],
	[0x6201, 0x2315, 0x8337, 0x1326, 0x5102],
	[0x3304, 0x2315, 0x8337, 0x1326],
	[0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245],
	[0x6201, 0x2315, 0x4113, 0x3304, 0x1146, 0x2245],
	[0x2315, 0x4113, 0x5102, 0x1146, 0x2245],
	[0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x1146, 0x2245, 0x6201, 0x4223, 0x1326],
	[0x3304, 0x1146, 0x2245, 0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x1146, 0x2245, 0x2315, 0x4113],
	[0x4223, 0x4113, 0x8337, 0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x4223, 0x4113, 0x8337],
	[0x4223, 0x6201, 0x2315, 0x8337, 0x3304, 0x1146, 0x2245],
	[0x4223, 0x8337, 0x2315, 0x2245, 0x1146, 0x5102],
	[0x5102, 0x4113, 0x8337, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x4113, 0x8337, 0x1326, 0x1146, 0x2245, 0x6201],
	[0x6201, 0x2315, 0x8337, 0x1326, 0x5102, 0x3304, 0x1146, 0x2245],
	[0x2245, 0x2315, 0x8337, 0x1326, 0x1146],
	[0x2315, 0x2245, 0x8157],
	[0x6201, 0x5102, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x4113, 0x6201, 0x2245, 0x8157],
	[0x2245, 0x8157, 0x4113, 0x5102, 0x3304],
	[0x5102, 0x4223, 0x1326, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x2245, 0x8157, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x3304, 0x2245, 0x8157, 0x4113],
	[0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x8337, 0x4223, 0x6201, 0x2245, 0x8157],
	[0x5102, 0x3304, 0x2245, 0x8157, 0x8337, 0x4223],
	[0x5102, 0x4113, 0x8337, 0x1326, 0x2315, 0x2245, 0x8157],
	[0x4113, 0x8337, 0x1326, 0x3304, 0x6201, 0x2315, 0x2245, 0x8157],
	[0x5102, 0x1326, 0x8337, 0x8157, 0x2245, 0x6201],
	[0x8157, 0x8337, 0x1326, 0x3304, 0x2245],
	[0x2315, 0x3304, 0x1146, 0x8157],
	[0x6201, 0x5102, 0x1146, 0x8157, 0x2315],
	[0x3304, 0x1146, 0x8157, 0x4113, 0x6201],
	[0x4113, 0x5102, 0x1146, 0x8157],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x5102, 0x4223, 0x1326],
	[0x1326, 0x4223, 0x6201, 0x2315, 0x8157, 0x1146],
	[0x3304, 0x1146, 0x8157, 0x4113, 0x6201, 0x5102, 0x4223, 0x1326],
	[0x1326, 0x1146, 0x8157, 0x4113, 0x4223],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x4223, 0x4113, 0x8337],
	[0x6201, 0x5102, 0x1146, 0x8157, 0x2315, 0x4223, 0x4113, 0x8337],
	[0x3304, 0x1146, 0x8157, 0x8337, 0x4223, 0x6201],
	[0x4223, 0x5102, 0x1146, 0x8157, 0x8337],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x5102, 0x4113, 0x8337, 0x1326],
	[0x6201, 0x4113, 0x8337, 0x1326, 0x1146, 0x8157, 0x2315],
	[0x6201, 0x3304, 0x1146, 0x8157, 0x8337, 0x1326, 0x5102],
	[0x1326, 0x1146, 0x8157, 0x8337],
	[0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2315, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x3304, 0x2315, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x4223, 0x8267, 0x1146],
	[0x3304, 0x6201, 0x4223, 0x8267, 0x1146],
	[0x5102, 0x4223, 0x8267, 0x1146, 0x6201, 0x2315, 0x4113],
	[0x1146, 0x8267, 0x4223, 0x4113, 0x2315, 0x3304],
	[0x4113, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2315, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x3304, 0x2315, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x8267, 0x1146, 0x5102, 0x4113, 0x8337],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x1146, 0x3304],
	[0x6201, 0x2315, 0x8337, 0x8267, 0x1146, 0x5102],
	[0x1146, 0x3304, 0x2315, 0x8337, 0x8267],
	[0x3304, 0x1326, 0x8267, 0x2245],
	[0x1326, 0x8267, 0x2245, 0x6201, 0x5102],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x6201, 0x2315, 0x4113],
	[0x1326, 0x8267, 0x2245, 0x2315, 0x4113, 0x5102],
	[0x5102, 0x4223, 0x8267, 0x2245, 0x3304],
	[0x6201, 0x4223, 0x8267, 0x2245],
	[0x5102, 0x4223, 0x8267, 0x2245, 0x3304, 0x6201, 0x2315, 0x4113],
	[0x4113, 0x4223, 0x8267, 0x2245, 0x2315],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x4223, 0x4113, 0x8337],
	[0x1326, 0x8267, 0x2245, 0x6201, 0x5102, 0x4223, 0x4113, 0x8337],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x4223, 0x6201, 0x2315, 0x8337],
	[0x5102, 0x1326, 0x8267, 0x2245, 0x2315, 0x8337, 0x4223],
	[0x3304, 0x2245, 0x8267, 0x8337, 0x4113, 0x5102],
	[0x8337, 0x8267, 0x2245, 0x6201, 0x4113],
	[0x5102, 0x6201, 0x2315, 0x8337, 0x8267, 0x2245, 0x3304],
	[0x2315, 0x8337, 0x8267, 0x2245],
	[0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2245, 0x8157, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x2245, 0x8157, 0x4113, 0x5102, 0x3304, 0x1326, 0x8267, 0x1146],
	[0x4223, 0x8267, 0x1146, 0x5102, 0x2315, 0x2245, 0x8157],
	[0x3304, 0x6201, 0x4223, 0x8267, 0x1146, 0x2315, 0x2245, 0x8157],
	[0x4223, 0x8267, 0x1146, 0x5102, 0x6201, 0x2245, 0x8157, 0x4113],
	[0x3304, 0x2245, 0x8157, 0x4113, 0x4223, 0x8267, 0x1146],
	[0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x8337, 0x4223, 0x6201, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x4223, 0x5102, 0x3304, 0x2245, 0x8157, 0x8337, 0x1326, 0x8267, 0x1146],
	[0x8267, 0x1146, 0x5102, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x1146, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x8337, 0x8267, 0x1146, 0x5102, 0x6201, 0x2245, 0x8157],
	[0x3304, 0x2245, 0x8157, 0x8337, 0x8267, 0x1146],
	[0x8157, 0x2315, 0x3304, 0x1326, 0x8267],
	[0x8267, 0x8157, 0x2315, 0x6201, 0x5102, 0x1326],
	[0x8267, 0x1326, 0x3304, 0x6201, 0x4113, 0x8157],
	[0x8267, 0x8157, 0x4113, 0x5102, 0x1326],
	[0x5102, 0x4223, 0x8267, 0x8157, 0x2315, 0x3304],
	[0x2315, 0x6201, 0x4223, 0x8267, 0x8157],
	[0x3304, 0x5102, 0x4223, 0x8267, 0x8157, 0x4113, 0x6201],
	[0x4113, 0x4223, 0x8267, 0x8157],
	[0x8157, 0x2315, 0x3304, 0x1326, 0x8267, 0x4223, 0x4113, 0x8337],
	[0x8157, 0x2315, 0x6201, 0x5102, 0x1326, 0x8267, 0x4223, 0x4113, 0x8337],
	[0x8157, 0x8337, 0x4223, 0x6201, 0x3304, 0x1326, 0x8267],
	[0x5102, 0x1326, 0x8267, 0x8157, 0x8337, 0x4223],
	[0x8267, 0x8157, 0x2315, 0x3304, 0x5102, 0x4113, 0x8337],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x8157, 0x2315],
	[0x6201, 0x3304, 0x5102, 0x8337, 0x8267, 0x8157],
	[0x8337, 0x8267, 0x8157],
	[0x8337, 0x8157, 0x8267],
	[0x6201, 0x5102, 0x3304, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x3304, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x4223, 0x1326, 0x3304, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x4113, 0x8157, 0x8267, 0x4223],
	[0x4223, 0x4113, 0x8157, 0x8267, 0x6201, 0x5102, 0x3304],
	[0x8157, 0x8267, 0x4223, 0x6201, 0x2315],
	[0x3304, 0x2315, 0x8157, 0x8267, 0x4223, 0x5102],
	[0x1326, 0x5102, 0x4113, 0x8157, 0x8267],
	[0x8157, 0x4113, 0x6201, 0x3304, 0x1326, 0x8267],
	[0x1326, 0x5102, 0x6201, 0x2315, 0x8157, 0x8267],
	[0x8267, 0x1326, 0x3304, 0x2315, 0x8157],
	[0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x2315, 0x4113, 0x5102, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x1146, 0x2245, 0x6201, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x4113, 0x4223, 0x1326, 0x1146, 0x2245, 0x2315, 0x8337, 0x8157, 0x8267],
	[0x4223, 0x4113, 0x8157, 0x8267, 0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x4223, 0x4113, 0x8157, 0x8267],
	[0x8157, 0x8267, 0x4223, 0x6201, 0x2315, 0x3304, 0x1146, 0x2245],
	[0x2315, 0x8157, 0x8267, 0x4223, 0x5102, 0x1146, 0x2245],
	[0x1326, 0x5102, 0x4113, 0x8157, 0x8267, 0x3304, 0x1146, 0x2245],
	[0x1326, 0x1146, 0x2245, 0x6201, 0x4113, 0x8157, 0x8267],
	[0x5102, 0x6201, 0x2315, 0x8157, 0x8267, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x1326, 0x1146, 0x2245, 0x2315, 0x8157, 0x8267],
	[0x2315, 0x2245, 0x8267, 0x8337],
	[0x2315, 0x2245, 0x8267, 0x8337, 0x6201, 0x5102, 0x3304],
	[0x4113, 0x6201, 0x2245, 0x8267, 0x8337],
	[0x5102, 0x4113, 0x8337, 0x8267, 0x2245, 0x3304],
	[0x2315, 0x2245, 0x8267, 0x8337, 0x5102, 0x4223, 0x1326],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x8337, 0x2315, 0x2245, 0x8267],
	[0x4113, 0x6201, 0x2245, 0x8267, 0x8337, 0x5102, 0x4223, 0x1326],
	[0x4113, 0x4223, 0x1326, 0x3304, 0x2245, 0x8267, 0x8337],
	[0x2315, 0x2245, 0x8267, 0x4223, 0x4113],
	[0x2315, 0x2245, 0x8267, 0x4223, 0x4113, 0x6201, 0x5102, 0x3304],
	[0x6201, 0x2245, 0x8267, 0x4223],
	[0x3304, 0x2245, 0x8267, 0x4223, 0x5102],
	[0x5102, 0x4113, 0x2315, 0x2245, 0x8267, 0x1326],
	[0x4113, 0x2315, 0x2245, 0x8267, 0x1326, 0x3304, 0x6201],
	[0x5102, 0x6201, 0x2245, 0x8267, 0x1326],
	[0x3304, 0x2245, 0x8267, 0x1326],
	[0x8267, 0x8337, 0x2315, 0x3304, 0x1146],
	[0x5102, 0x1146, 0x8267, 0x8337, 0x2315, 0x6201],
	[0x3304, 0x1146, 0x8267, 0x8337, 0x4113, 0x6201],
	[0x8337, 0x4113, 0x5102, 0x1146, 0x8267],
	[0x8267, 0x8337, 0x2315, 0x3304, 0x1146, 0x5102, 0x4223, 0x1326],
	[0x1146, 0x8267, 0x8337, 0x2315, 0x6201, 0x4223, 0x1326],
	[0x8267, 0x8337, 0x4113, 0x6201, 0x3304, 0x1146, 0x5102, 0x4223, 0x1326],
	[0x4113, 0x4223, 0x1326, 0x1146, 0x8267, 0x8337],
	[0x3304, 0x2315, 0x4113, 0x4223, 0x8267, 0x1146],
	[0x2315, 0x6201, 0x5102, 0x1146, 0x8267, 0x4223, 0x4113],
	[0x1146, 0x8267, 0x4223, 0x6201, 0x3304],
	[0x5102, 0x1146, 0x8267, 0x4223],
	[0x8267, 0x1326, 0x5102, 0x4113, 0x2315, 0x3304, 0x1146],
	[0x6201, 0x4113, 0x2315, 0x1326, 0x1146, 0x8267],
	[0x6201, 0x3304, 0x1146, 0x8267, 0x1326, 0x5102],
	[0x1326, 0x1146, 0x8267],
	[0x1326, 0x8337, 0x8157, 0x1146],
	[0x8337, 0x8157, 0x1146, 0x1326, 0x6201, 0x5102, 0x3304],
	[0x8337, 0x8157, 0x1146, 0x1326, 0x6201, 0x2315, 0x4113],
	[0x4113, 0x5102, 0x3304, 0x2315, 0x1326, 0x8337, 0x8157, 0x1146],
	[0x8337, 0x8157, 0x1146, 0x5102, 0x4223],
	[0x6201, 0x4223, 0x8337, 0x8157, 0x1146, 0x3304],
	[0x8337, 0x8157, 0x1146, 0x5102, 0x4223, 0x6201, 0x2315, 0x4113],
	[0x4223, 0x8337, 0x8157, 0x1146, 0x3304, 0x2315, 0x4113],
	[0x4223, 0x4113, 0x8157, 0x1146, 0x1326],
	[0x4223, 0x4113, 0x8157, 0x1146, 0x1326, 0x6201, 0x5102, 0x3304],
	[0x1146, 0x8157, 0x2315, 0x6201, 0x4223, 0x1326],
	[0x4223, 0x5102, 0x3304, 0x2315, 0x8157, 0x1146, 0x1326],
	[0x4113, 0x8157, 0x1146, 0x5102],
	[0x6201, 0x4113, 0x8157, 0x1146, 0x3304],
	[0x2315, 0x8157, 0x1146, 0x5102, 0x6201],
	[0x2315, 0x8157, 0x1146, 0x3304],
	[0x2245, 0x3304, 0x1326, 0x8337, 0x8157],
	[0x6201, 0x2245, 0x8157, 0x8337, 0x1326, 0x5102],
	[0x2245, 0x3304, 0x1326, 0x8337, 0x8157, 0x6201, 0x2315, 0x4113],
	[0x2245, 0x2315, 0x4113, 0x5102, 0x1326, 0x8337, 0x8157],
	[0x4223, 0x8337, 0x8157, 0x2245, 0x3304, 0x5102],
	[0x8157, 0x2245, 0x6201, 0x4223, 0x8337],
	[0x2245, 0x3304, 0x5102, 0x4223, 0x8337, 0x8157, 0x4113, 0x6201, 0x2315],
	[0x4223, 0x8337, 0x8157, 0x2245, 0x2315, 0x4113],
	[0x4113, 0x8157, 0x2245, 0x3304, 0x1326, 0x4223],
	[0x1326, 0x4223, 0x4113, 0x8157, 0x2245, 0x6201, 0x5102],
	[0x8157, 0x2245, 0x3304, 0x1326, 0x4223, 0x6201, 0x2315],
	[0x5102, 0x1326, 0x4223, 0x2315, 0x8157, 0x2245],
	[0x3304, 0x5102, 0x4113, 0x8157, 0x2245],
	[0x4113, 0x8157, 0x2245, 0x6201],
	[0x5102, 0x6201, 0x2315, 0x8157, 0x2245, 0x3304],
	[0x2315, 0x8157, 0x2245],
	[0x1146, 0x1326, 0x8337, 0x2315, 0x2245],
	[0x1146, 0x1326, 0x8337, 0x2315, 0x2245, 0x6201, 0x5102, 0x3304],
	[0x6201, 0x2245, 0x1146, 0x1326, 0x8337, 0x4113],
	[0x2245, 0x1146, 0x1326, 0x8337, 0x4113, 0x5102, 0x3304],
	[0x5102, 0x1146, 0x2245, 0x2315, 0x8337, 0x4223],
	[0x1146, 0x3304, 0x6201, 0x4223, 0x8337, 0x2315, 0x2245],
	[0x8337, 0x4113, 0x6201, 0x2245, 0x1146, 0x5102, 0x4223],
	[0x4223, 0x8337, 0x4113, 0x3304, 0x2245, 0x1146],
	[0x4113, 0x2315, 0x2245, 0x1146, 0x1326, 0x4223],
	[0x1146, 0x1326, 0x4223, 0x4113, 0x2315, 0x2245, 0x6201, 0x5102, 0x3304],
	[0x1326, 0x4223, 0x6201, 0x2245, 0x1146],
	[0x4223, 0x5102, 0x3304, 0x2245, 0x1146, 0x1326],
	[0x2245, 0x1146, 0x5102, 0x4113, 0x2315],
	[0x4113, 0x2315, 0x2245, 0x1146, 0x3304, 0x6201],
	[0x6201, 0x2245, 0x1146, 0x5102],
	[0x3304, 0x2245, 0x1146],
	[0x3304, 0x1326, 0x8337, 0x2315],
	[0x5102, 0x1326, 0x8337, 0x2315, 0x6201],
	[0x6201, 0x3304, 0x1326, 0x8337, 0x4113],
	[0x5102, 0x1326, 0x8337, 0x4113],
	[0x4223, 0x8337, 0x2315, 0x3304, 0x5102],
	[0x6201, 0x4223, 0x8337, 0x2315],
	[0x3304, 0x5102, 0x4223, 0x8337, 0x4113, 0x6201],
	[0x4113, 0x4223, 0x8337],
	[0x4113, 0x2315, 0x3304, 0x1326, 0x4223],
	[0x1326, 0x4223, 0x4113, 0x2315, 0x6201, 0x5102],
	[0x3304, 0x1326, 0x4223, 0x6201],
	[0x5102, 0x1326, 0x4223],
	[0x5102, 0x4113, 0x2315, 0x3304],
	[0x6201, 0x4113, 0x2315],
	[0x6201, 0x3304, 0x5102],
	[]
]

func _edge_to_vertex(edge :int) -> Vector3:
	return (_vertex_lookup[edge & 0x7] + _vertex_lookup[(edge & 0x70) >> 4]) / 2.0

func _vertex_to_absolute(cube_position :Vector3i):
	return _negative_bound + precision * Vector3(cube_position)

## TODO: add assertions
func _does_vertex_belong(cube_position :Vector3i, vertex :int) -> int:
	if sdf.get_value_at(_vertex_to_absolute(cube_position) + precision * Vector3(_vertex_lookup[vertex])) < _treshold:
		return 1
	
	return 0
	
func _get_cube_type(cube_position :Vector3i):
	var encoded_cube_type :int = 0
	for vertex in range(7, 0, -1):
		encoded_cube_type |= _does_vertex_belong(cube_position, vertex)
		encoded_cube_type <<= 1
		
	return _cubes_lookup[encoded_cube_type]

func _get_vertex_array_at(cube_position :Vector3i):
	return _cubes_lookup[_get_cube_type(cube_position)]

## TODO: add assertions
## Returns the number of layers in each direction that the CubeMarcher has to iterate over
func _iterations() -> Vector3i:
	return Vector3i((_positive_bound - _negative_bound) / precision)

## Returns a mesh of the SDF
func get_mesh() -> ArrayMesh:
	var surface_tool = SurfaceTool.new()
	surface_tool.begin(Mesh.PRIMITIVE_TRIANGLES)
	
	var max_iterations = _iterations()
	for x in range(0, max_iterations.x):
		for y in range(0, max_iterations.y):
			for z in range(0, max_iterations.z):
				var cube_type = _get_cube_type(Vector3i(x, y, z))
				
				var absolute_cube_position = _vertex_to_absolute(Vector3i(x, y, z))
				for edge in cube_type:
					surface_tool.add_vertex(_edge_to_vertex(edge) + absolute_cube_position)
	
	return surface_tool.commit()
